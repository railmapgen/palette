System.register(["./chakra-legacy-0hWQw7Oq.js","./react-legacy-KN5lAqTZ.js","./index-legacy-sRbwun-D.js","./pantone-input-legacy-8hc49-sV.js","./line-detail-card-legacy-L1RR838z.js","./pantone-checker-legacy-PNMqYMGB.js"],(function(e,n){"use strict";var t,s,i,r,o,a,l,c,d,u,h,j,x,g,p,m,y,f,v,C,b,w,k,L,S,E,R,O,P,I,z,N,U,A,F,M,D,J,T,q,$,B,G,K,_,H,V,W,Y,Z,Q,X,ee,ne,te,se,ie,re,oe,ae,le,ce,de,ue,he,je,xe,ge,pe,me,ye,fe,ve;return{setters:[e=>{t=e.j,s=e._,i=e.O,r=e.a0,o=e.f,a=e.r,l=e.s,c=e.a2,d=e.e,u=e.t,h=e.$,j=e.v,x=e.a3,g=e.w,p=e.a4,m=e.a5,y=e.M,f=e.a6,v=e.p,C=e.q,b=e.F},e=>{w=e.l,k=e.r,L=e.o},e=>{S=e.b,E=e.u,R=e.L,O=e.i,P=e.j,I=e.k,z=e.l,N=e.m,U=e.n,A=e.o,F=e.p,M=e.q,D=e.t,J=e.v,T=e.w,q=e.x,$=e.y,B=e.z,G=e.A,K=e.B,_=e.C,H=e.D,V=e.F,W=e.G,Y=e.H,Z=e.I,Q=e.J,X=e.K,ee=e.N,ne=e.O,te=e.P,se=e.Q,ie=e.S,re=e.r,oe=e.T,ae=e.U,le=e.g,ce=e.h,de=e.E},e=>{ue=e.R,he=e.M,je=e.a,xe=e.b,ge=e.c,pe=e.d},e=>{me=e.u,ye=e.M,fe=e.L},e=>{ve=e.P}],execute:function(){function n(){const{t:e,i18n:n}=w(),r=me(),o=S(),{countryList:a}=E((e=>e.app)),{country:l,newCountry:c,countryName:d,newCountryLang:u}=E((e=>e.ticket)),h={...a.map((e=>[e.id,r(e.name)])).sort(((e,t)=>e[1].localeCompare(t[1],n.languages[0]))).reduce(((e,n)=>"UN"===n[0]?e:{...e,[n[0]]:n[1]}),{"":e("Please select...")}),new:e("Add a country/region...")},j=Object.entries(R).reduce(((e,n)=>({...e,[n[0]]:r(n[1])})),{}),x=[{type:"select",label:e("Country/Region"),value:l,options:h,disabledOptions:[""],onChange:e=>o(O(e))},{type:"input",label:e("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:c,validator:e=>""!==e&&!!e.match(/^[A-Z]{2}$|^GB[A-Z]{3}$/),onChange:e=>o(P(e)),hidden:"new"!==l},{type:"select",label:e("Official language"),value:u,options:j,onChange:e=>o(I(e||void 0)),hidden:"new"!==l}];return t.jsxs(z,{children:[t.jsx(N,{children:t.jsx(s,{as:"h5",size:"sm",children:e("Country/Region")})}),t.jsxs(i.div,{px:1,children:[t.jsx(ue,{fields:x}),"new"===l&&t.jsx(ye,{entries:d,onUpdate:(e,n)=>o(U({lang:e,name:n})),onLangSwitch:(e,n)=>o(A({prevLang:e,nextLang:n})),onRemove:e=>o(F(e))})]})]})}function Ce(){const{t:e,i18n:n}=w(),r=S(),o=me(),{cityList:a}=E((e=>e.app)),{country:l,city:c,newCity:d,cityName:u}=E((e=>e.ticket)),h={...a.filter((e=>e.country===l)).map((e=>[e.id,o(e.name)])).sort(((e,t)=>e[1].localeCompare(t[1],n.languages[0]))).reduce(((e,n)=>({...e,[n[0]]:n[1]})),{"":e("Please select...")}),new:e("Add a city")+"..."},j=[{type:"select",label:e("City"),value:c,options:h,disabledOptions:[""],onChange:e=>(async e=>{if("new"===e)return void r(q("new"));const n=await $(e,a);r(n?B(n):G())})(e)},{type:"input",label:e("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:d,onChange:e=>r(M(e)),validator:e=>""!==e&&!e.match(/[^a-z]/),hidden:"new"!==c}];return t.jsxs(z,{children:[t.jsx(N,{children:t.jsx(s,{as:"h5",size:"sm",children:e("City")})}),t.jsxs(i.div,{px:1,children:[t.jsx(ue,{fields:j}),"new"===c&&t.jsx(ye,{entries:u,onUpdate:(e,n)=>r(D({lang:e,name:n})),onLangSwitch:(e,n)=>r(J({prevLang:e,nextLang:n})),onRemove:e=>r(T(e))})]})]})}function be(){const{t:e}=w(),n=S(),i=E((e=>e.ticket.lines));return t.jsxs(z,{children:[t.jsxs(N,{children:[t.jsx(s,{as:"h5",size:"sm",mr:"auto",children:e("Lines")}),t.jsx(ve,{})]}),t.jsxs(r,{spacing:1,px:1,children:[Object.entries(i).map((([e,s])=>t.jsx(fe,{lineDetail:s,editable:!0,onUpdate:t=>n(K({entryId:e,updates:t})),onMoveUp:()=>n(_(e)),onMoveDown:()=>n(H(e)),onCopy:()=>n(V(e)),onRemove:()=>n(W(e)),onNameUpdate:(t,s)=>n(Y({entryId:e,lang:t,name:s})),onLangSwitch:(t,s)=>n(Z({entryId:e,prevLang:t,nextLang:s})),onNameRemove:t=>n(Q({entryId:e,lang:t}))},e))),t.jsx(o,{size:"xs",variant:"ghost",leftIcon:t.jsx(he,{}),ml:"auto !important",onClick:()=>n(X()),children:e("Add a line")})]})]})}function we(e){const{countryErrors:n,cityErrors:i,lineErrors:r,onIgnore:j,onClose:x}=e,{t:g}=w(),p=me();return t.jsxs(t.Fragment,{children:[t.jsxs(a,{children:[t.jsx(l,{children:g("Your inputs contain the following errors. Please consider fixing it before submitting.")}),n.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("Country/Region")}),t.jsx(c,{"aria-label":"List of country errors",children:n.map(((e,n)=>t.jsx(d,{children:p(ee[e])},n)))})]}),i.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("City")}),t.jsx(c,{"aria-label":"List of city errors",children:i.map(((e,n)=>t.jsx(d,{children:p(ee[e])},n)))})]}),Object.values(r).flat().length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("Lines")}),t.jsx(c,{"aria-label":"List of line errors",children:Object.entries(r).map((([e,n])=>t.jsxs(d,{children:[e,t.jsx(c,{children:n.map(((e,n)=>t.jsx(d,{children:p(ee[e])},n)))})]},e)))})]})]}),t.jsx(u,{children:t.jsxs(h,{children:[t.jsx(o,{onClick:j,children:g("Submit anyway")}),t.jsx(o,{colorScheme:"primary",onClick:x,children:g("Go back")})]})})]})}e("default",(function(){const{t:e}=w(),s=S(),i=L(),{isDataLoading:r}=E((e=>e.app)),[a,l]=k.useState(),[c,d]=k.useState(!1),[u,j]=k.useState(!1);return k.useEffect((()=>{const e=re.storage.get(oe);if(e)try{const n=JSON.parse(e);Object.keys(n.lines).length>0&&Object.values(n.lines)[0].id&&(l(n),d(!0))}catch(n){console.error("TicketView:: unable to restore draft ticket",e)}}),[]),t.jsxs(le,{alignSelf:"center",sx:{width:{base:"100%",md:520}},children:[r&&t.jsx(ce,{isIndeterminate:!0}),t.jsxs(b,{direction:"column",flex:1,overflowY:"auto",bg:"inherit",children:[t.jsx(n,{}),t.jsx(Ce,{}),t.jsx(be,{})]}),t.jsxs(b,{my:2,children:[t.jsx(o,{size:"sm",onClick:()=>{re.isStandaloneWindow()?i("/"):re.openApp("rmg-palette")},children:e("Go back")}),t.jsxs(h,{ml:"auto",children:[t.jsx(o,{size:"sm",variant:"outline",onClick:()=>{s(ae()),re.storage.remove(oe),re.event(de.RESET_TICKET,{})},children:e("Reset")}),t.jsx(o,{size:"sm",colorScheme:"primary",onClick:()=>j(!0),children:e("Submit")})]})]}),t.jsx(Re,{isOpen:c,onClose:()=>d(!1),incomingState:a}),t.jsx(Ee,{isOpen:u,onClose:()=>j(!1)})]})}));const ke=e=>{var n;return!(null===(n=e.match(/^https?:\/\//))||void 0===n||!n[0])};function Le(e){const{refLink:n,onRefLinkChange:s,justification:i,onJustificationChange:r,onPrev:c,onNext:d}=e,{t:h}=w(),j=[{type:"input",value:n,label:h("Reference link"),placeholder:h("Enter a valid URL, e.g.")+" https://en.wikipedia.org",onChange:s,validator:ke},{type:"textarea",value:i,label:h("Justification"),placeholder:h("Briefly describe your changes and provide justification"),onChange:r}],x=!n||!i||!ke(n);return t.jsxs(t.Fragment,{children:[t.jsxs(a,{children:[t.jsx(l,{children:h("Please provide suitable source and justification.")}),t.jsx(ue,{fields:j,minW:"full"})]}),t.jsxs(u,{children:[c&&t.jsx(o,{variant:"ghost",onClick:c,mr:"auto",leftIcon:t.jsx(je,{}),children:h("Previous")}),t.jsx(o,{colorScheme:"primary",onClick:d,rightIcon:t.jsx(xe,{}),isDisabled:x,children:h("Next")})]})]})}function Se(e){var n,s;const{countryEntry:i,cityEntry:r,paletteList:c,refLink:h,justification:m,onPrev:y}=e,{t:f}=w(),v=j("primary.500","primary.300"),C=k.useRef(null),b=[`**Reference link:** ${h||"(REPLACE ME)"}`,`**Justification:** ${m||"(REPLACE ME)"}`,ne,te("country",i),te("city",r),te("lines",c)].join("\n\n"),L=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+(null==r||null===(n=r.name)||void 0===n?void 0:n.en),body:b}),S=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+(null==r||null===(s=r.name)||void 0===s?void 0:s.en)});return t.jsxs(t.Fragment,{children:[t.jsxs(a,{children:[t.jsx(l,{children:f("If the button below doesn't work for you, please follow the instructions below:")}),t.jsxs(x,{children:[t.jsxs(d,{children:[f("Open")," ",t.jsxs(g,{color:v,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+S.toString(),isExternal:!0,children:["Issue: New Palettes Request ",t.jsx(p,{as:ge})]})]}),t.jsxs(d,{children:[f("Paste following text to the issue body")," ",t.jsx(o,{size:"xs",leftIcon:t.jsx(pe,{}),onClick:async()=>{null!=C&&C.current&&(C.current.select(),await navigator.clipboard.writeText(b))},children:f("Copy")}),t.jsx(se,{ref:C,isReadOnly:!0,defaultValue:b,onClick:({target:e})=>e.select()})]})]})]}),t.jsxs(u,{children:[t.jsx(o,{variant:"ghost",onClick:y,mr:"auto",leftIcon:t.jsx(je,{}),children:f("Previous")}),t.jsx(o,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+L.toString(),"_blank"),children:f("1-click open issue")})]})]})}function Ee(e){const{isOpen:n,onClose:s}=e,{t:i}=w(),[r,o]=k.useState([]),[a,l]=k.useState([]),[c,d]=k.useState({}),[u,h]=k.useState(""),[j,x]=k.useState(""),[g,p]=k.useState(!1),[b,L]=k.useState(!1),{countryList:S}=E((e=>e.app)),R=E((e=>e.ticket)),O=ie.getCountryEntry(R),P=ie.getCityEntry(R),I=ie.getPalettes(R);k.useEffect((()=>{n?(o(ie.getCountryErrors(R)),l(ie.getCityErrors(R,S)),d(ie.getLineErrors(R,S))):(p(!1),h(""),x(""),L(!1))}),[n]);const z=r.length>0||a.length>0||Object.values(c).flat().length>0,N=z&&!g,U=!N&&!b;return t.jsxs(m,{blockScrollOnMount:!1,isOpen:n,onClose:s,scrollBehavior:"inside",children:[t.jsx(y,{}),t.jsxs(f,{children:[t.jsx(v,{children:i("Submit palettes")}),t.jsx(C,{onClick:()=>{N||U||re.storage.remove(oe),s()}}),N&&t.jsx(we,{countryErrors:r,cityErrors:a,lineErrors:c,onIgnore:()=>p(!0),onClose:s}),U&&t.jsx(Le,{refLink:u,onRefLinkChange:h,justification:j,onJustificationChange:x,onPrev:z?()=>p(!1):void 0,onNext:()=>L(!0)}),!N&&!U&&t.jsx(Se,{countryEntry:O,cityEntry:P,paletteList:I,refLink:u,justification:j,onPrev:()=>L(!1)})]})]})}function Re(e){const{isOpen:n,onClose:s,incomingState:i}=e,{t:r}=w(),l=S();return t.jsxs(m,{isOpen:n,onClose:s,children:[t.jsx(y,{}),t.jsxs(f,{children:[t.jsx(v,{children:r("Unsaved draft")}),t.jsx(C,{}),t.jsx(a,{children:r("Do you want to continue with your last unsaved ticket?")}),t.jsx(u,{children:t.jsxs(h,{children:[t.jsx(o,{onClick:()=>{re.storage.remove(oe),s()},children:r("Discard")}),t.jsx(o,{colorScheme:"primary",onClick:()=>{i&&l(ae(i)),s()},children:r("Continue")})]})})]})]})}}}}));
