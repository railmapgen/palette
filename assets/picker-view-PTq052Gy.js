import{H as t,F as K,ap as X,K as I,W as q,g as Z,ac as J,D as Q,aq as T}from"./chakra-oz4Mm5GU.js";import{u as A,Y as H,M as y,a as V,W as D,l as ee,m as te,b as oe,r as E,E as P,g as ne,h as se,Z as ae,_ as le}from"./index-HAs5VQI_.js";import{l as B,r as h,p as re}from"./react-CVMQYbqF.js";import{u as M,P as ce,R as _,i as ie}from"./pantone-input-yNPZVCrp.js";import{u as ue}from"./use-palette-kFT8zR4R.js";import{P as de}from"./pantone-checker-YkaOe2MQ.js";const pe=d=>{const o=d.toUpperCase().split("");return o.length===2?o.map(r=>((r.codePointAt(0)||0)+127397).toString(16).toUpperCase()):o.length===5?["1F3F4",...o.map(r=>((r.codePointAt(0)||0)+917536).toString(16).toUpperCase()),"E007F"]:[]},me=d=>{const o=pe(d);return String.fromCodePoint(...o.map(r=>parseInt(r,16)))};function Ce(d){const{defaultValueId:o,onChange:r}=d,{i18n:p}=B(),g=M(),{countryList:f,cityList:a}=A(e=>e.app),x=o?a.find(e=>e.id===o):void 0,j=e=>{const l=e.country==="TW"&&["zh-Hans","zh-CN"].includes(p.languages[0]);return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"flag-emoji",children:l?"🏴":me(e.country)}),t.jsx("span",{children:g(e.name)})]})},u=(e,l)=>{var c,m;const n=e.toLocaleLowerCase();return l.id.toLocaleLowerCase().includes(n)||Object.values(l.name).some(i=>i.toLocaleLowerCase().includes(n))||l.country.toLocaleLowerCase().includes(n)||Object.values((m=(c=f.find(i=>l.country===i.id))==null?void 0:c.name)!=null?m:{}).some(i=>i.toLocaleLowerCase().includes(n))},C=a.slice().map(e=>({...e,value:g(e.name)})).sort((e,l)=>e.id==="other"?1:l.id==="other"?-1:e.value.localeCompare(l.value,p.languages[0]));return t.jsx(H,{data:C,displayHandler:j,filter:u,value:x&&g(x.name),onChange:e=>r==null?void 0:r(e.id)})}const ge={display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"};function he(d){const{city:o,defaultValueId:r,onChange:p,onSubmit:g}=d,f=M(),a=ue(o),x=r?a.find(e=>e.id===r):void 0,j=e=>t.jsx(V,{name:f(e.name),fg:e.fg||y.white,bg:e.colour,title:f(e.name),sx:ge}),u=(e,l)=>{const n=e.toLocaleLowerCase();return l.id.toLocaleLowerCase().includes(n)||Object.values(l.name).some(c=>c.toLocaleLowerCase().includes(n))},C=a.map(e=>({...e,value:f(e.name)}));return t.jsx(H,{data:C,displayHandler:j,filter:u,value:x&&f(x.name),onChange:e=>p==null?void 0:p(e.id,e.colour,e.fg||y.white,e.pantone),InputPropsByState:e=>({onKeyDown:({key:l})=>!e&&l==="Enter"&&(g==null?void 0:g())})})}const O=d=>!!d.match(/^#[0-9a-fA-F]{6}$/),fe={flexDirection:"column",flex:1,mx:2,overflowX:"hidden",overflowY:"auto","& .chakra-badge":{fontSize:"1em",width:"fit-content",alignSelf:"center",m:1},"& > section:first-of-type":{p:1},"& > section:last-of-type":{w:"100%","& > div:last-of-type":{px:2},"& .rmg-section__header button":{ml:"auto"}}};function xe(d){const{defaultTheme:o,sessionId:r,onSubmit:p,onClose:g,onClearHistory:f}=d,{t:a}=B(),{recentlyUsed:x,pantoneReady:j}=A(s=>s.app),[u,C]=h.useState(o==null?void 0:o[0]),[e,l]=h.useState(o==null?void 0:o[1]),[n,c]=h.useState((o==null?void 0:o[2])||"#AAAAAA"),[m,i]=h.useState((o==null?void 0:o[3])||y.white),[N,S]=h.useState(""),[v,w]=h.useState("color"),b=()=>{S(""),w(s=>s==="pantone"?"color":s)};h.useEffect(()=>{r&&o&&(C(o[0]),l(o[1]),c(o[2]),i(o[3]),b())},[r,o==null?void 0:o.toString()]);const W=[{label:a("Select"),value:"color"},{label:a("RGB"),value:"text"},{label:a("Pantone®"),value:"pantone",disabled:!j}],z=[{label:a("Black"),value:y.black},{label:a("White"),value:y.white}],R=u&&e&&n&&m&&O(n),F=()=>{if(R){const s="".concat(u," - ").concat(e);p==null||p([u,e,n,m],s)}},U=[{type:"custom",label:a("City"),component:t.jsx(Ce,{defaultValueId:u,onChange:s=>{C(s),l(void 0),c("#AAAAAA"),i(y.white)}})},{type:"custom",label:a("Line"),component:t.jsx(he,{city:u,defaultValueId:e,onChange:(s,L,G,k)=>{l(s),c(L),i(G),k&&S(k)},onSubmit:F})}],$=[{type:"custom",label:a("Input mode"),component:t.jsx(D,{selections:W,defaultValue:v,onChange:s=>w(s)})},{type:"custom",label:a("Pantone® code"),component:t.jsx(ce,{value:N,onChange:(s,L)=>{C("other"),l("other"),c(L),S(s)}}),hidden:v!=="pantone"},{type:"input",label:a("Background colour"),variant:v==="pantone"?"color":v,value:n,placeholder:"#F3D03E",validator:O,onChange:s=>{C("other"),l("other"),c(s),b()},isDisabled:v==="pantone"},{type:"custom",label:a("Foreground colour"),component:t.jsx(D,{selections:z,defaultValue:m,onChange:s=>{C("other"),l("other"),i(s)}})}],Y=s=>{C(s[0]),l(s[1]),c(s[2]),i(s[3]),b()};return t.jsxs(t.Fragment,{children:[t.jsxs(K,{sx:fe,children:[t.jsx(V,{name:a("Example"),fg:m,bg:n}),t.jsxs(ee,{children:[t.jsx(de,{hidden:!0}),t.jsx(_,{fields:U}),t.jsx(_,{fields:$})]}),t.jsxs("section",{children:[t.jsxs(te,{children:[t.jsx(X,{as:"h5",size:"xs",children:a("Recently used")}),t.jsx(I,{variant:"ghost",size:"xs",onClick:f,children:a("Clear")})]}),t.jsx(q,{children:x.map(({theme:s,displayName:L})=>t.jsx(Z,{children:t.jsx(J,{size:"xs","aria-label":a("Apply"),title:L,mt:"0.45px",color:s[3],bg:s[2],icon:t.jsx(ie,{}),onClick:()=>Y(s)})},s.join("-")))})]})]}),t.jsx(Q,{}),t.jsxs(T,{p:2,justifyContent:"flex-end",children:[t.jsx(I,{size:"sm",onClick:g,children:a("Cancel")}),t.jsx(I,{size:"sm",colorScheme:"primary",onClick:F,isDisabled:!R,children:a("Confirm")})]})]})}const je="rmg-palette-bridge--";function be(){const[d]=re(),o=d.get("parentId"),r=d.get("parentComponent"),p=oe(),{isDataLoading:g}=A(n=>n.app),[f,a]=h.useState(),[x,j]=h.useState(),u=h.useRef();h.useEffect(()=>{const n=new BroadcastChannel(je+o);return u.current=n,E.event(P.APP_CLIP_VIEW_OPENED,{parentComponent:r}),n.onmessage=c=>{const{event:m,data:i}=c.data;console.log("[".concat(n.name,"] Received event from parent component:"),m),m==="OPEN"&&(a(crypto.randomUUID()),j(i))},console.log("[".concat(n.name,"] App clip connection established, parentComponent=").concat(r)),n.postMessage({event:"LOADED"}),()=>{n.close()}},[]);const C=(n,c)=>{var m,i;console.log("[".concat((m=u.current)==null?void 0:m.name,"] Emitting SELECT event, theme:"),n),(i=u.current)==null||i.postMessage({event:"SELECT",data:n}),p(ae({theme:n,displayName:c})),E.event(P.APP_CLIP_VIEW_SELECT,{parentComponent:r,theme:n})},e=()=>{var n,c;console.log("[".concat((n=u.current)==null?void 0:n.name,"] Emitting CLOSE event")),(c=u.current)==null||c.postMessage({event:"CLOSE"}),E.event(P.APP_CLIP_VIEW_CLOSED,{parentComponent:r})},l=()=>{p(le()),E.event(P.CLEAR_HISTORY,{})};return t.jsxs(ne,{children:[g&&t.jsx(se,{isIndeterminate:!0}),t.jsx(xe,{defaultTheme:x,sessionId:f,onSubmit:C,onClose:e,onClearHistory:l})]})}export{be as default};
