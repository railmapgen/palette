import{H as e,F as K,ap as X,K as L,W as q,g as Z,ac as J,D as Q,aq as T}from"./chakra-oz4Mm5GU.js";import{u as A,Y as O,M as v,a as V,W as _,l as ee,m as te,b as oe,r as P,E as S,g as ne,h as se,Z as ae,_ as re}from"./index--B9gOwhA.js";import{l as B,r as g,p as le}from"./react-CVMQYbqF.js";import{u as M,P as ce,R as k,i as ie}from"./pantone-input-rEhGlQl-.js";import{u as ue}from"./use-palette-nI6xdG3U.js";import{P as de}from"./pantone-checker-2xhOH3f9.js";const pe=d=>{const t=d.toUpperCase().split("");return t.length===2?t.map(l=>((l.codePointAt(0)||0)+127397).toString(16).toUpperCase()):t.length===5?["1F3F4",...t.map(l=>((l.codePointAt(0)||0)+917536).toString(16).toUpperCase()),"E007F"]:[]},me=d=>{const t=pe(d);return String.fromCodePoint(...t.map(l=>parseInt(l,16)))};function ge(d){const{defaultValueId:t,onChange:l}=d,{i18n:p}=B(),m=M(),{cityList:C}=A(n=>n.app),r=t?C.find(n=>n.id===t):void 0,x=n=>{const o=n.country==="TW"&&["zh-Hans","zh-CN"].includes(p.languages[0]);return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flag-emoji",children:o?"🏴":me(n.country)}),e.jsx("span",{children:m(n.name)})]})},j=(n,o)=>{const c=n.toLocaleLowerCase();return o.id.toLocaleLowerCase().includes(c)||Object.values(o.name).some(a=>a.toLowerCase().includes(c))},i=C.slice().map(n=>({...n,value:m(n.name)})).sort((n,o)=>n.id==="other"?1:o.id==="other"?-1:n.value.localeCompare(o.value,p.languages[0]));return e.jsx(O,{data:i,displayHandler:x,filter:j,value:r&&m(r.name),onChange:n=>l==null?void 0:l(n.id)})}function Ce(d){const{city:t,defaultValueId:l,onChange:p,onSubmit:m}=d,C=M(),r=ue(t),x=l?r.find(o=>o.id===l):void 0,j=o=>e.jsx(V,{name:C(o.name),fg:o.fg||v.white,bg:o.colour}),i=(o,c)=>{const a=o.toLocaleLowerCase();return c.id.toLocaleLowerCase().includes(a)||Object.values(c.name).some(u=>u.toLocaleLowerCase().includes(a))},n=r.map(o=>({...o,value:C(o.name)}));return e.jsx(O,{data:n,displayHandler:j,filter:i,value:x&&C(x.name),onChange:o=>p==null?void 0:p(o.id,o.colour,o.fg||v.white,o.pantone),InputPropsByState:o=>({onKeyDown:({key:c})=>!o&&c==="Enter"&&(m==null?void 0:m())})})}const H=d=>!!d.match(/^#[0-9a-fA-F]{6}$/),he={flexDirection:"column",flex:1,mx:2,overflowX:"hidden",overflowY:"auto","& .chakra-badge":{fontSize:"1em",width:"fit-content",alignSelf:"center",m:1},"& > section:first-of-type":{p:1},"& > section:last-of-type":{w:"100%","& > div:last-of-type":{px:2},"& .rmg-section__header button":{ml:"auto"}}};function fe(d){const{defaultTheme:t,sessionId:l,onSubmit:p,onClose:m,onClearHistory:C}=d,{t:r}=B(),{recentlyUsed:x,pantoneReady:j}=A(s=>s.app),[i,n]=g.useState(t==null?void 0:t[0]),[o,c]=g.useState(t==null?void 0:t[1]),[a,u]=g.useState((t==null?void 0:t[2])||"#AAAAAA"),[h,f]=g.useState((t==null?void 0:t[3])||v.white),[N,b]=g.useState(""),[y,R]=g.useState("color"),I=()=>{b(""),R(s=>s==="pantone"?"color":s)};g.useEffect(()=>{l&&t&&(n(t[0]),c(t[1]),u(t[2]),f(t[3]),I())},[l,t==null?void 0:t.toString()]);const W=[{label:r("Select"),value:"color"},{label:r("RGB"),value:"text"},{label:r("Pantone®"),value:"pantone",disabled:!j}],z=[{label:r("Black"),value:v.black},{label:r("White"),value:v.white}],w=i&&o&&a&&h&&H(a),F=()=>{if(w){const s="".concat(i," - ").concat(o);p==null||p([i,o,a,h],s)}},U=[{type:"custom",label:r("City"),component:e.jsx(ge,{defaultValueId:i,onChange:s=>{n(s),c(void 0),u("#AAAAAA"),f(v.white)}})},{type:"custom",label:r("Line"),component:e.jsx(Ce,{city:i,defaultValueId:o,onChange:(s,E,G,D)=>{c(s),u(E),f(G),D&&b(D)},onSubmit:F})}],$=[{type:"custom",label:r("Input mode"),component:e.jsx(_,{selections:W,defaultValue:y,onChange:s=>R(s)})},{type:"custom",label:r("Pantone® code"),component:e.jsx(ce,{value:N,onChange:(s,E)=>{n("other"),c("other"),u(E),b(s)}}),hidden:y!=="pantone"},{type:"input",label:r("Background colour"),variant:y==="pantone"?"color":y,value:a,placeholder:"#F3D03E",validator:H,onChange:s=>{n("other"),c("other"),u(s),I()},isDisabled:y==="pantone"},{type:"custom",label:r("Foreground colour"),component:e.jsx(_,{selections:z,defaultValue:h,onChange:s=>{n("other"),c("other"),f(s)}})}],Y=s=>{n(s[0]),c(s[1]),u(s[2]),f(s[3]),I()};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{sx:he,children:[e.jsx(V,{name:r("Example"),fg:h,bg:a}),e.jsxs(ee,{children:[e.jsx(de,{hidden:!0}),e.jsx(k,{fields:U}),e.jsx(k,{fields:$})]}),e.jsxs("section",{children:[e.jsxs(te,{children:[e.jsx(X,{as:"h5",size:"xs",children:r("Recently used")}),e.jsx(L,{variant:"ghost",size:"xs",onClick:C,children:r("Clear")})]}),e.jsx(q,{children:x.map(({theme:s,displayName:E})=>e.jsx(Z,{children:e.jsx(J,{size:"xs","aria-label":r("Apply"),title:E,mt:"0.45px",color:s[3],bg:s[2],icon:e.jsx(ie,{}),onClick:()=>Y(s)})},s.join("-")))})]})]}),e.jsx(Q,{}),e.jsxs(T,{p:2,justifyContent:"flex-end",children:[e.jsx(L,{size:"sm",onClick:m,children:r("Cancel")}),e.jsx(L,{size:"sm",colorScheme:"primary",onClick:F,isDisabled:!w,children:r("Confirm")})]})]})}const xe="rmg-palette-bridge--";function be(){const[d]=le(),t=d.get("parentId"),l=d.get("parentComponent"),p=oe(),{isDataLoading:m}=A(a=>a.app),[C,r]=g.useState(),[x,j]=g.useState(),i=g.useRef();g.useEffect(()=>{const a=new BroadcastChannel(xe+t);return i.current=a,P.event(S.APP_CLIP_VIEW_OPENED,{parentComponent:l}),a.onmessage=u=>{const{event:h,data:f}=u.data;console.log("[".concat(a.name,"] Received event from parent component:"),h),h==="OPEN"&&(r(crypto.randomUUID()),j(f))},console.log("[".concat(a.name,"] App clip connection established, parentComponent=").concat(l)),a.postMessage({event:"LOADED"}),()=>{a.close()}},[]);const n=(a,u)=>{var h,f;console.log("[".concat((h=i.current)==null?void 0:h.name,"] Emitting SELECT event, theme:"),a),(f=i.current)==null||f.postMessage({event:"SELECT",data:a}),p(ae({theme:a,displayName:u})),P.event(S.APP_CLIP_VIEW_SELECT,{parentComponent:l,theme:a})},o=()=>{var a,u;console.log("[".concat((a=i.current)==null?void 0:a.name,"] Emitting CLOSE event")),(u=i.current)==null||u.postMessage({event:"CLOSE"}),P.event(S.APP_CLIP_VIEW_CLOSED,{parentComponent:l})},c=()=>{p(re()),P.event(S.CLEAR_HISTORY,{})};return e.jsxs(ne,{children:[m&&e.jsx(se,{isIndeterminate:!0}),e.jsx(fe,{defaultTheme:x,sessionId:C,onSubmit:n,onClose:o,onClearHistory:c})]})}export{be as default};
