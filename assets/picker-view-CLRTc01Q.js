import{n as t,ac as Y,p as L,h as q,W as K,o as Z,$ as D,F as J,D as Q,ad as T}from"./chakra-C7mz8WDx.js";import{u as b,Z as B,_ as ee,M as v,a as V,b as U,m as te,$ as oe,r as S,E as I,a0 as ne,X as _,l as se,g as ae,h as le,a1 as re}from"./index-CgzWA51A.js";import{n as R,a as h,q as ce}from"./react-Xm5uCCSw.js";import{u as $,i as ie,e as de,P as ue,R as O}from"./pantone-input-DVSAd4h8.js";import{u as pe}from"./use-palette-Ck-ngji8.js";import{P as me}from"./pantone-checker-CgDRkjM7.js";const Ce=d=>{const o=d.toUpperCase().split("");return o.length===2?o.map(a=>((a.codePointAt(0)||0)+127397).toString(16).toUpperCase()):o.length===5?["1F3F4",...o.map(a=>((a.codePointAt(0)||0)+917536).toString(16).toUpperCase()),"E007F"]:[]},ge=d=>{const o=Ce(d);return String.fromCodePoint(...o.map(a=>parseInt(a,16)))};function he(d){const{defaultValueId:o,onChange:a}=d,{i18n:g}=R(),C=$(),{countryList:s,cityList:x}=b(e=>e.app),p=o?x.find(e=>e.id===o):void 0,r=e=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"flag-emoji",children:ge(ee(e.country))}),t.jsx("span",{children:C(e.name)})]}),c=(e,n)=>{var u,f;const i=e.toLocaleLowerCase();return n.id.toLocaleLowerCase().includes(i)||Object.values(n.name).some(j=>j.toLocaleLowerCase().includes(i))||n.country.toLocaleLowerCase().includes(i)||Object.values((f=(u=s.find(j=>n.country===j.id))==null?void 0:u.name)!=null?f:{}).some(j=>j.toLocaleLowerCase().includes(i))},m=x.slice().map(e=>({...e,value:C(e.name)})).sort((e,n)=>e.id==="other"?1:n.id==="other"?-1:e.value.localeCompare(n.value,g.languages[0]));return t.jsx(B,{data:m,displayHandler:r,filter:c,value:p&&C(p.name),onChange:e=>a==null?void 0:a(e.id)})}const xe={display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"};function fe(d){const{city:o,defaultValueId:a,onChange:g,onSubmit:C}=d,s=$(),x=pe(o),p=a?x.find(e=>e.id===a):void 0,r=e=>t.jsx(V,{name:s(e.name),fg:e.fg||v.white,bg:e.colour,title:s(e.name),sx:xe}),c=(e,n)=>{const i=e.toLocaleLowerCase();return n.id.toLocaleLowerCase().includes(i)||Object.values(n.name).some(u=>u.toLocaleLowerCase().includes(i))},m=x.map(e=>({...e,value:s(e.name)}));return t.jsx(B,{data:m,displayHandler:r,filter:c,value:p&&s(p.name),onChange:e=>g==null?void 0:g(e.id,e.colour,e.fg||v.white,e.pantone),InputPropsByState:e=>({onKeyDown:({key:n})=>!e&&n==="Enter"&&(C==null?void 0:C())})})}function je({onApply:d}){const{t:o}=R(),a=U(),{recentlyUsed:g}=b(r=>r.app),[C,s]=h.useState(!1),x=r=>{a(oe(r)),S.event(I.REMOVE_HISTORY_ITEM,{})},p=()=>{a(ne()),S.event(I.CLEAR_HISTORY,{})};return t.jsxs("section",{children:[t.jsxs(te,{children:[t.jsx(Y,{as:"h5",size:"xs",children:o("Recently used")}),C?t.jsxs(t.Fragment,{children:[t.jsx(L,{variant:"ghost",size:"xs",onClick:p,children:o("Clear all")}),t.jsx(L,{colorScheme:"primary",size:"xs",onClick:()=>s(!1),sx:{ml:"1 !important"},children:o("Done")})]}):t.jsx(L,{variant:"ghost",size:"xs",onClick:()=>s(!0),children:o("Clear")})]}),t.jsx(q,{children:g.map(({theme:r,displayName:c},m)=>t.jsx(K,{children:t.jsxs(Z,{size:"xs",isAttached:!0,children:[t.jsx(D,{size:"xs","aria-label":o("Apply")+" "+c,title:c,mt:"0.45px",color:r[3],bg:r[2],icon:t.jsx(ie,{}),onClick:()=>d(r)}),C&&t.jsx(D,{variant:"outline","aria-label":o("Remove")+" "+c,title:o("Remove")+" "+c,mt:"0.45px",icon:t.jsx(de,{}),onClick:()=>x(m)})]})},r.join("-")))})]})}const M=d=>!!d.match(/^#[0-9a-fA-F]{6}$/),ve={flexDirection:"column",flex:1,mx:2,overflowX:"hidden",overflowY:"auto","& .chakra-badge":{fontSize:"1em",width:"fit-content",alignSelf:"center",m:1},"& > section:first-of-type":{p:1},"& > section:last-of-type":{w:"100%","& > div:last-of-type":{px:2},"& .rmg-section__header button":{ml:"auto"}}};function ye(d){const{defaultTheme:o,sessionId:a,onSubmit:g,onClose:C}=d,{t:s}=R(),{pantoneReady:x}=b(l=>l.app),[p,r]=h.useState(o==null?void 0:o[0]),[c,m]=h.useState(o==null?void 0:o[1]),[e,n]=h.useState((o==null?void 0:o[2])||"#AAAAAA"),[i,u]=h.useState((o==null?void 0:o[3])||v.white),[f,j]=h.useState(""),[y,A]=h.useState("color"),P=()=>{j(""),A(l=>l==="pantone"?"color":l)};h.useEffect(()=>{a&&o&&(r(o[0]),m(o[1]),n(o[2]),u(o[3]),P())},[a,o==null?void 0:o.toString()]);const z=[{label:s("Select"),value:"color"},{label:s("RGB"),value:"text"},{label:s("Pantone®"),value:"pantone",disabled:!x}],H=[{label:s("Black"),value:v.black},{label:s("White"),value:v.white}],w=p&&c&&e&&i&&M(e),F=()=>{if(w){const l="".concat(p," - ").concat(c),E=e.toLowerCase();g==null||g([p,c,E,i],l)}},W=[{type:"custom",label:s("City"),component:t.jsx(he,{defaultValueId:p,onChange:l=>{r(l),m(void 0),n("#AAAAAA"),u(v.white)}})},{type:"custom",label:s("Line"),component:t.jsx(fe,{city:p,defaultValueId:c,onChange:(l,E,X,k)=>{m(l),n(E),u(X),k&&j(k)},onSubmit:F})}],N=[{type:"custom",label:s("Input mode"),component:t.jsx(_,{selections:z,defaultValue:y,onChange:l=>A(l)})},{type:"custom",label:s("Pantone® code"),component:t.jsx(ue,{value:f,onChange:(l,E)=>{r("other"),m("other"),n(E),j(l)}}),hidden:y!=="pantone"},{type:"input",label:s("Background colour"),variant:y==="pantone"?"color":y,value:e,placeholder:"#F3D03E",validator:M,onChange:l=>{r("other"),m("other"),n(l),P()},isDisabled:y==="pantone"},{type:"custom",label:s("Foreground colour"),component:t.jsx(_,{selections:H,defaultValue:i,onChange:l=>{r("other"),m("other"),u(l)}})}],G=l=>{r(l[0]),m(l[1]),n(l[2]),u(l[3]),P()};return t.jsxs(t.Fragment,{children:[t.jsxs(J,{sx:ve,children:[t.jsx(V,{name:s("Example"),fg:i,bg:e}),t.jsxs(se,{children:[t.jsx(me,{hidden:!0}),t.jsx(O,{fields:W}),t.jsx(O,{fields:N})]}),t.jsx(je,{onApply:G})]}),t.jsx(Q,{}),t.jsxs(T,{p:2,justifyContent:"flex-end",children:[t.jsx(L,{size:"sm",onClick:C,children:s("Cancel")}),t.jsx(L,{size:"sm",colorScheme:"primary",onClick:F,isDisabled:!w,children:s("Confirm")})]})]})}const Ee="rmg-palette-bridge--";function Ae(){const[d]=ce(),o=d.get("parentId"),a=d.get("parentComponent"),g=U(),{isDataLoading:C}=b(n=>n.app),[s,x]=h.useState(),[p,r]=h.useState(),c=h.useRef();h.useEffect(()=>{const n=new BroadcastChannel(Ee+o);return c.current=n,S.event(I.APP_CLIP_VIEW_OPENED,{parentComponent:a}),n.onmessage=i=>{const{event:u,data:f}=i.data;console.log("[".concat(n.name,"] Received event from parent component:"),u),u==="OPEN"&&(x(crypto.randomUUID()),r(f))},console.log("[".concat(n.name,"] App clip connection established, parentComponent=").concat(a)),n.postMessage({event:"LOADED"}),()=>{n.close()}},[]);const m=(n,i)=>{var u,f;console.log("[".concat((u=c.current)==null?void 0:u.name,"] Emitting SELECT event, theme:"),n),(f=c.current)==null||f.postMessage({event:"SELECT",data:n}),g(re({theme:n,displayName:i})),S.event(I.APP_CLIP_VIEW_SELECT,{parentComponent:a,theme:n})},e=()=>{var n,i;console.log("[".concat((n=c.current)==null?void 0:n.name,"] Emitting CLOSE event")),(i=c.current)==null||i.postMessage({event:"CLOSE"}),S.event(I.APP_CLIP_VIEW_CLOSED,{parentComponent:a})};return t.jsxs(ae,{children:[C&&t.jsx(le,{isIndeterminate:!0}),t.jsx(ye,{defaultTheme:p,sessionId:s,onSubmit:m,onClose:e})]})}export{Ae as default};
