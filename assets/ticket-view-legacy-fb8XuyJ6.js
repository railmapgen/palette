System.register(["./chakra-legacy-d6DHdpZA.js","./react-legacy-YX5Z9y-r.js","./index-legacy-Gy9ZQJYR.js","./pantone-input-legacy-U5Mv_8_N.js","./line-detail-card-legacy-bu55CN3p.js","./pantone-checker-legacy-g8XY8FGc.js"],(function(e,n){"use strict";var t,s,i,r,a,o,l,c,d,u,h,j,x,g,p,m,y,f,C,v,b,w,k,S,L,E,O,R,P,I,z,N,D,U,A,F,M,J,T,$,q,B,G,K,H,V,Y,_,Z,Q,W,X,ee,ne,te,se,ie,re,ae,oe,le,ce,de,ue,he,je,xe,ge,pe,me,ye,fe,Ce;return{setters:[e=>{t=e.H,s=e.ap,i=e.a,r=e.ar,a=e.K,o=e.a0,l=e.a1,c=e.as,d=e.at,u=e.a2,h=e.aq,j=e.a3,x=e.au,g=e.a4,p=e.av,m=e.aw,y=e.Y,f=e.ax,C=e._,v=e.$,b=e.F},e=>{w=e.l,k=e.r},e=>{S=e.b,L=e.u,E=e.L,O=e.i,R=e.j,P=e.k,I=e.l,z=e.m,N=e.n,D=e.o,U=e.p,A=e.q,F=e.t,M=e.v,J=e.w,T=e.x,$=e.y,q=e.z,B=e.A,G=e.B,K=e.C,H=e.D,V=e.F,Y=e.G,_=e.H,Z=e.I,Q=e.J,W=e.K,X=e.N,ee=e.O,ne=e.P,te=e.Q,se=e.S,ie=e.T,re=e.r,ae=e.U,oe=e.V,le=e.g,ce=e.h,de=e.E},e=>{ue=e.u,he=e.R,je=e.M,xe=e.a,ge=e.b,pe=e.c,me=e.d},e=>{ye=e.M,fe=e.L},e=>{Ce=e.P}],execute:function(){function n(){const{t:e,i18n:n}=w(),r=ue(),a=S(),{countryList:o}=L((e=>e.app)),{country:l,newCountry:c,countryName:d,newCountryLang:u}=L((e=>e.ticket)),h={...o.map((e=>[e.id,r(e.name)])).sort(((e,t)=>e[1].localeCompare(t[1],n.languages[0]))).reduce(((e,n)=>"UN"===n[0]?e:{...e,[n[0]]:n[1]}),{"":e("Please select...")}),new:e("Add a country/region...")},j=Object.entries(E).reduce(((e,n)=>({...e,[n[0]]:r(n[1])})),{}),x=[{type:"select",label:e("Country/Region"),value:l,options:h,disabledOptions:[""],onChange:e=>a(O(e))},{type:"input",label:e("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:c,validator:e=>""!==e&&!!e.match(/^[A-Z]{2}$|^GB[A-Z]{3}$/),onChange:e=>a(R(e)),hidden:"new"!==l},{type:"select",label:e("Official language"),value:u,options:j,onChange:e=>a(P(e||void 0)),hidden:"new"!==l}];return t.jsxs(I,{children:[t.jsx(z,{children:t.jsx(s,{as:"h5",size:"sm",children:e("Country/Region")})}),t.jsxs(i.div,{px:1,children:[t.jsx(he,{fields:x}),"new"===l&&t.jsx(ye,{entries:d,onUpdate:(e,n)=>a(N({lang:e,name:n})),onLangSwitch:(e,n)=>a(D({prevLang:e,nextLang:n})),onRemove:e=>a(U(e))})]})]})}function ve(){const{t:e,i18n:n}=w(),r=S(),a=ue(),{cityList:o}=L((e=>e.app)),{country:l,city:c,newCity:d,cityName:u}=L((e=>e.ticket)),h={...o.filter((e=>e.country===l)).map((e=>[e.id,a(e.name)])).sort(((e,t)=>e[1].localeCompare(t[1],n.languages[0]))).reduce(((e,n)=>({...e,[n[0]]:n[1]})),{"":e("Please select...")}),new:e("Add a city")+"..."},j=[{type:"select",label:e("City"),value:c,options:h,disabledOptions:[""],onChange:e=>(async e=>{if("new"===e)return void r(T("new"));const n=await $(e,o);r(n?q(n):B())})(e)},{type:"input",label:e("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:d,onChange:e=>r(A(e)),validator:e=>""!==e&&!e.match(/[^a-z]/),hidden:"new"!==c}];return t.jsxs(I,{children:[t.jsx(z,{children:t.jsx(s,{as:"h5",size:"sm",children:e("City")})}),t.jsxs(i.div,{px:1,children:[t.jsx(he,{fields:j}),"new"===c&&t.jsx(ye,{entries:u,onUpdate:(e,n)=>r(F({lang:e,name:n})),onLangSwitch:(e,n)=>r(M({prevLang:e,nextLang:n})),onRemove:e=>r(J(e))})]})]})}function be(){const{t:e}=w(),n=S(),i=L((e=>e.ticket.lines));return t.jsxs(I,{children:[t.jsxs(z,{children:[t.jsx(s,{as:"h5",size:"sm",mr:"auto",children:e("Lines")}),t.jsx(Ce,{})]}),t.jsxs(r,{spacing:1,px:1,children:[Object.entries(i).map((([e,s])=>t.jsx(fe,{lineDetail:s,editable:!0,onUpdate:t=>n(G({entryId:e,updates:t})),onMoveUp:()=>n(K(e)),onMoveDown:()=>n(H(e)),onCopy:()=>n(V(e)),onRemove:()=>n(Y(e)),onNameUpdate:(t,s)=>n(_({entryId:e,lang:t,name:s})),onLangSwitch:(t,s)=>n(Z({entryId:e,prevLang:t,nextLang:s})),onNameRemove:t=>n(Q({entryId:e,lang:t}))},e))),t.jsx(a,{size:"xs",variant:"ghost",leftIcon:t.jsx(je,{}),ml:"auto !important",onClick:()=>n(W()),children:e("Add a line")})]})]})}function we(e){const{countryErrors:n,cityErrors:i,lineErrors:r,onIgnore:j,onClose:x}=e,{t:g}=w(),p=ue();return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:g("Your inputs contain the following errors. Please consider fixing it before submitting.")}),n.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("Country/Region")}),t.jsx(c,{"aria-label":"List of country errors",children:n.map(((e,n)=>t.jsx(d,{children:p(X[e])},n)))})]}),i.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("City")}),t.jsx(c,{"aria-label":"List of city errors",children:i.map(((e,n)=>t.jsx(d,{children:p(X[e])},n)))})]}),Object.values(r).flat().length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("Lines")}),t.jsx(c,{"aria-label":"List of line errors",children:Object.entries(r).map((([e,n])=>t.jsxs(d,{children:[e,t.jsx(c,{children:n.map(((e,n)=>t.jsx(d,{children:p(X[e])},n)))})]},e)))})]})]}),t.jsx(u,{children:t.jsxs(h,{children:[t.jsx(a,{onClick:j,children:g("Submit anyway")}),t.jsx(a,{colorScheme:"primary",onClick:x,children:g("Go back")})]})})]})}e("default",(function(){const{t:e}=w(),s=S(),{isDataLoading:i}=L((e=>e.app)),[r,o]=k.useState(),[l,c]=k.useState(!1),[d,u]=k.useState(!1);return k.useEffect((()=>{const e=re.storage.get(ae);if(e)try{const n=JSON.parse(e);Object.keys(n.lines).length>0&&Object.values(n.lines)[0].id&&(o(n),c(!0))}catch(n){console.error("TicketView:: unable to restore draft ticket",e)}}),[]),t.jsxs(le,{alignSelf:"center",sx:{width:{base:"100%",md:520}},children:[i&&t.jsx(ce,{isIndeterminate:!0}),t.jsxs(b,{direction:"column",flex:1,overflowY:"auto",bg:"inherit",children:[t.jsx(n,{}),t.jsx(ve,{}),t.jsx(be,{})]}),t.jsxs(b,{my:2,children:[t.jsx(a,{size:"sm",onClick:()=>{re.openApp({appId:"rmg-palette"})},children:e("Go back")}),t.jsxs(h,{ml:"auto",children:[t.jsx(a,{size:"sm",variant:"outline",onClick:()=>{s(oe()),re.storage.remove(ae),re.event(de.RESET_TICKET,{})},children:e("Reset")}),t.jsx(a,{size:"sm",colorScheme:"primary",onClick:()=>u(!0),children:e("Submit")})]})]}),t.jsx(Oe,{isOpen:l,onClose:()=>c(!1),incomingState:r}),t.jsx(Ee,{isOpen:d,onClose:()=>u(!1)})]})}));const ke=e=>{var n;return!(null===(n=e.match(/^https?:\/\//))||void 0===n||!n[0])};function Se(e){const{dataSource:n,onDataSourceChange:s,refLink:i,onRefLinkChange:r,justification:c,onJustificationChange:d,onPrev:h,onNext:j}=e,{t:x}=w(),g=ue(),p=Object.fromEntries([["",x("Please select...")],...Object.entries(ee).map((([e,n])=>[e,g(n)]))]),m=[{type:"select",label:x("Data source"),options:p,disabledOptions:[""],value:n,onChange:e=>s(e)},{type:"input",value:i,label:x("Reference link"),placeholder:x("Enter a valid URL, e.g.")+" https://en.wikipedia.org",onChange:r,validator:ke},{type:"textarea",value:c,label:x("Justification"),placeholder:x("Briefly describe your changes and provide justification"),onChange:d}],y=!(n&&i&&c&&ke(i));return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:x("Please provide suitable source and justification.")}),t.jsx(he,{fields:m,minW:"full"})]}),t.jsxs(u,{children:[h&&t.jsx(a,{variant:"ghost",onClick:h,mr:"auto",leftIcon:t.jsx(xe,{}),children:x("Previous")}),t.jsx(a,{colorScheme:"primary",onClick:j,rightIcon:t.jsx(ge,{}),isDisabled:y,children:x("Next")})]})]})}function Le(e){var n,s;const{countryEntry:i,cityEntry:r,paletteList:c,dataSource:h,refLink:m,justification:y,onPrev:f}=e,{t:C}=w(),v=ue(),b=j("primary.500","primary.300"),S=k.useRef(null),L=[`**Data source:** ${h?v(ee[h]):"(REPLACE ME)"}`,`**Reference link:** ${m||"(REPLACE ME)"}`,`**Justification:** ${y||"(REPLACE ME)"}`,ne,te("country",i),te("city",r),te("lines",c)].join("\n\n"),E=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+(null==r||null===(n=r.name)||void 0===n?void 0:n.en),body:L}),O=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+(null==r||null===(s=r.name)||void 0===s?void 0:s.en)});return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:C("If the button below doesn't work for you, please follow the instructions below:")}),t.jsxs(x,{children:[t.jsxs(d,{children:[C("Open")," ",t.jsxs(g,{color:b,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+O.toString(),isExternal:!0,children:["Issue: New Palettes Request ",t.jsx(p,{as:pe})]})]}),t.jsxs(d,{children:[C("Paste following text to the issue body")," ",t.jsx(a,{size:"xs",leftIcon:t.jsx(me,{}),onClick:async()=>{null!=S&&S.current&&(S.current.select(),await navigator.clipboard.writeText(L))},children:C("Copy")}),t.jsx(se,{ref:S,isReadOnly:!0,defaultValue:L,onClick:({target:e})=>e.select()})]})]})]}),t.jsxs(u,{children:[t.jsx(a,{variant:"ghost",onClick:f,mr:"auto",leftIcon:t.jsx(xe,{}),children:C("Previous")}),t.jsx(a,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+E.toString(),"_blank"),children:C("1-click open issue")})]})]})}function Ee(e){const{isOpen:n,onClose:s}=e,{t:i}=w(),[r,a]=k.useState([]),[o,l]=k.useState([]),[c,d]=k.useState({}),[u,h]=k.useState(""),[j,x]=k.useState(""),[g,p]=k.useState(""),[b,S]=k.useState(!1),[E,O]=k.useState(!1),{countryList:R}=L((e=>e.app)),P=L((e=>e.ticket)),I=ie.getCountryEntry(P),z=ie.getCityEntry(P),N=ie.getPalettes(P);k.useEffect((()=>{n?(a(ie.getCountryErrors(P)),l(ie.getCityErrors(P,R)),d(ie.getLineErrors(P,R))):(S(!1),h(""),x(""),p(""),O(!1))}),[n]);const D=r.length>0||o.length>0||Object.values(c).flat().length>0,U=D&&!b,A=!U&&!E;return t.jsxs(m,{blockScrollOnMount:!1,isOpen:n,onClose:s,scrollBehavior:"inside",children:[t.jsx(y,{}),t.jsxs(f,{children:[t.jsx(C,{children:i("Submit palettes")}),t.jsx(v,{onClick:()=>{U||A||re.storage.remove(ae),s()}}),U&&t.jsx(we,{countryErrors:r,cityErrors:o,lineErrors:c,onIgnore:()=>S(!0),onClose:s}),A&&t.jsx(Se,{dataSource:u,onDataSourceChange:h,refLink:j,onRefLinkChange:x,justification:g,onJustificationChange:p,onPrev:D?()=>S(!1):void 0,onNext:()=>O(!0)}),!U&&!A&&t.jsx(Le,{countryEntry:I,cityEntry:z,paletteList:N,dataSource:u,refLink:j,justification:g,onPrev:()=>O(!1)})]})]})}function Oe(e){const{isOpen:n,onClose:s,incomingState:i}=e,{t:r}=w(),l=S();return t.jsxs(m,{isOpen:n,onClose:s,children:[t.jsx(y,{}),t.jsxs(f,{children:[t.jsx(C,{children:r("Unsaved draft")}),t.jsx(v,{}),t.jsx(o,{children:r("Do you want to continue with your last unsaved ticket?")}),t.jsx(u,{children:t.jsxs(h,{children:[t.jsx(a,{onClick:()=>{re.storage.remove(ae),s()},children:r("Discard")}),t.jsx(a,{colorScheme:"primary",onClick:()=>{i&&l(oe(i)),s()},children:r("Continue")})]})})]})]})}}}}));
