System.register(["./chakra-legacy-Zux3yh9G.js","./react-legacy-CCsCkahv.js","./index-legacy-CTf337g-.js","./pantone-input-legacy-CUEH9qZF.js","./line-detail-card-legacy-B0qp9rQO.js","./pantone-checker-legacy-CTfkD7Sl.js"],(function(e,n){"use strict";var t,s,i,r,a,o,l,c,d,u,h,j,x,g,p,m,y,f,C,b,v,w,k,S,L,E,O,R,P,I,N,z,D,U,A,M,F,J,T,G,$,q,B,K,H,V,W,Y,Z,_,Q,X,ee,ne,te,se,ie,re,ae,oe,le,ce,de,ue,he,je,xe,ge,pe,me,ye,fe,Ce,be;return{setters:[e=>{t=e.n,s=e.ac,i=e.c,r=e.ae,a=e.p,o=e.H,l=e.J,c=e.af,d=e.ag,u=e.K,h=e.ad,j=e.L,x=e.ah,g=e.N,p=e.ai,m=e.aj,y=e.M,f=e.ak,C=e.E,b=e.G,v=e.F},e=>{w=e.n,k=e.a},e=>{S=e.b,L=e.u,E=e.L,O=e.i,R=e.j,P=e.k,I=e.l,N=e.m,z=e.n,D=e.o,U=e.p,A=e.q,M=e.t,F=e.v,J=e.w,T=e.x,G=e.y,$=e.z,q=e.A,B=e.B,K=e.C,H=e.D,V=e.F,W=e.G,Y=e.H,Z=e.I,_=e.J,Q=e.K,X=e.N,ee=e.O,ne=e.P,te=e.Q,se=e.S,ie=e.T,re=e.r,ae=e.U,oe=e.V,le=e.W,ce=e.g,de=e.h,ue=e.E},e=>{he=e.u,je=e.R,xe=e.M,ge=e.a,pe=e.b,me=e.c,ye=e.d},e=>{fe=e.M,Ce=e.L},e=>{be=e.P}],execute:function(){function n(){const{t:e,i18n:n}=w(),r=he(),a=S(),{countryList:o}=L((e=>e.app)),{country:l,newCountry:c,countryName:d,newCountryLang:u}=L((e=>e.ticket)),h={...o.map((e=>[e.id,r(e.name)])).sort(((e,t)=>e[1].localeCompare(t[1],n.languages[0]))).reduce(((e,n)=>"UN"===n[0]?e:{...e,[n[0]]:n[1]}),{"":e("Please select...")}),new:e("Add a country/region...")},j=Object.entries(E).reduce(((e,n)=>({...e,[n[0]]:r(n[1])})),{}),x=[{type:"select",label:e("Country/Region"),value:l,options:h,disabledOptions:[""],onChange:e=>a(O(e))},{type:"input",label:e("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:c,validator:e=>""!==e&&!!e.match(/^[A-Z]{2}$|^GB[A-Z]{3}$/),onChange:e=>a(R(e)),hidden:"new"!==l},{type:"select",label:e("Official language"),value:u,options:j,onChange:e=>a(P(e||void 0)),hidden:"new"!==l}];return t.jsxs(I,{children:[t.jsx(N,{children:t.jsx(s,{as:"h5",size:"sm",children:e("Country/Region")})}),t.jsxs(i.div,{px:1,children:[t.jsx(je,{fields:x}),"new"===l&&t.jsx(fe,{entries:d,onUpdate:(e,n)=>a(z({lang:e,name:n})),onLangSwitch:(e,n)=>a(D({prevLang:e,nextLang:n})),onRemove:e=>a(U(e))})]})]})}function ve(){const{t:e,i18n:n}=w(),r=S(),a=he(),{cityList:o}=L((e=>e.app)),{country:l,city:c,newCity:d,cityName:u}=L((e=>e.ticket)),h={...o.filter((e=>e.country===l)).map((e=>[e.id,a(e.name)])).sort(((e,t)=>e[1].localeCompare(t[1],n.languages[0]))).reduce(((e,n)=>({...e,[n[0]]:n[1]})),{"":e("Please select...")}),new:e("Add a city")+"..."},j=[{type:"select",label:e("City"),value:c,options:h,disabledOptions:[""],onChange:e=>(async e=>{if("new"===e)return void r(T("new"));const n=await G(e,o);r(n?$(n):q())})(e)},{type:"input",label:e("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:d,onChange:e=>r(A(e)),validator:e=>""!==e&&!e.match(/[^a-z]/),hidden:"new"!==c}];return t.jsxs(I,{children:[t.jsx(N,{children:t.jsx(s,{as:"h5",size:"sm",children:e("City")})}),t.jsxs(i.div,{px:1,children:[t.jsx(je,{fields:j}),"new"===c&&t.jsx(fe,{entries:u,onUpdate:(e,n)=>r(M({lang:e,name:n})),onLangSwitch:(e,n)=>r(F({prevLang:e,nextLang:n})),onRemove:e=>r(J(e))})]})]})}function we(){const{t:e}=w(),n=S(),i=L((e=>e.ticket.lines));return t.jsxs(I,{children:[t.jsxs(N,{children:[t.jsx(s,{as:"h5",size:"sm",mr:"auto",children:e("Lines")}),t.jsx(be,{})]}),t.jsxs(r,{spacing:1,px:1,children:[Object.entries(i).map((([e,s])=>t.jsx(Ce,{lineDetail:s,editable:!0,onUpdate:t=>n(B({entryId:e,updates:t})),onMoveUp:()=>n(K(e)),onMoveDown:()=>n(H(e)),onCopy:()=>n(V(e)),onRemove:()=>n(W(e)),onNameUpdate:(t,s)=>n(Y({entryId:e,lang:t,name:s})),onLangSwitch:(t,s)=>n(Z({entryId:e,prevLang:t,nextLang:s})),onNameRemove:t=>n(_({entryId:e,lang:t}))},e))),t.jsx(a,{size:"xs",variant:"ghost",leftIcon:t.jsx(xe,{}),ml:"auto !important",onClick:()=>n(Q()),children:e("Add a line")})]})]})}function ke(e){const{countryErrors:n,cityErrors:i,lineErrors:r,onIgnore:j,onClose:x}=e,{t:g}=w(),p=he();return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:g("Your inputs contain the following errors. Please consider fixing it before submitting.")}),n.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("Country/Region")}),t.jsx(c,{"aria-label":"List of country errors",children:n.map(((e,n)=>t.jsx(d,{children:p(X[e])},n)))})]}),i.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("City")}),t.jsx(c,{"aria-label":"List of city errors",children:i.map(((e,n)=>t.jsx(d,{children:p(X[e])},n)))})]}),Object.values(r).flat().length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("Lines")}),t.jsx(c,{"aria-label":"List of line errors",children:Object.entries(r).map((([e,n])=>t.jsxs(d,{children:[e,t.jsx(c,{children:n.map(((e,n)=>t.jsx(d,{children:p(X[e])},n)))})]},e)))})]})]}),t.jsx(u,{children:t.jsxs(h,{children:[t.jsx(a,{onClick:j,children:g("Submit anyway")}),t.jsx(a,{colorScheme:"primary",onClick:x,children:g("Go back")})]})})]})}e("default",(function(){const{t:e}=w(),s=S(),{isDataLoading:i}=L((e=>e.app)),[r,o]=k.useState(),[l,c]=k.useState(!1),[d,u]=k.useState(!1);return k.useEffect((()=>{const e=re.storage.get(ae);if(e)try{const n=JSON.parse(e);Object.keys(n.lines).length>0&&Object.values(n.lines)[0].id&&(o(n),c(!0))}catch{le.error("<TicketView/>, unable to restore draft ticket",e)}}),[]),t.jsxs(ce,{alignSelf:"center",sx:{width:{base:"100%",md:520}},children:[i&&t.jsx(de,{isIndeterminate:!0}),t.jsxs(v,{direction:"column",flex:1,overflowY:"auto",bg:"inherit",children:[t.jsx(n,{}),t.jsx(ve,{}),t.jsx(we,{})]}),t.jsxs(v,{my:2,children:[t.jsx(a,{size:"sm",onClick:()=>{re.openApp({appId:"rmg-palette"})},children:e("Go back")}),t.jsxs(h,{ml:"auto",children:[t.jsx(a,{size:"sm",variant:"outline",onClick:()=>{s(oe()),re.storage.remove(ae),re.event(ue.RESET_TICKET,{})},children:e("Reset")}),t.jsx(a,{size:"sm",colorScheme:"primary",onClick:()=>u(!0),children:e("Submit")})]})]}),t.jsx(Re,{isOpen:l,onClose:()=>c(!1),incomingState:r}),t.jsx(Oe,{isOpen:d,onClose:()=>u(!1)})]})}));const Se=e=>!!e.match(/^https?:\/\//)?.[0];function Le(e){const{dataSource:n,onDataSourceChange:s,refLink:i,onRefLinkChange:r,justification:c,onJustificationChange:d,onPrev:h,onNext:j}=e,{t:x}=w(),g=he(),p=Object.fromEntries([["",x("Please select...")],...Object.entries(ee).map((([e,n])=>[e,g(n)]))]),m=[{type:"select",label:x("Data source"),options:p,disabledOptions:[""],value:n,onChange:e=>s(e)},{type:"input",value:i,label:x("Reference link"),placeholder:x("Enter a valid URL, e.g.")+" https://en.wikipedia.org",onChange:r,validator:Se},{type:"textarea",value:c,label:x("Justification"),placeholder:x("Briefly describe your changes and provide justification"),onChange:d}],y=!(n&&i&&c&&Se(i));return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:x("Please provide suitable source and justification.")}),t.jsx(je,{fields:m,minW:"full"})]}),t.jsxs(u,{children:[h&&t.jsx(a,{variant:"ghost",onClick:h,mr:"auto",leftIcon:t.jsx(ge,{}),children:x("Previous")}),t.jsx(a,{colorScheme:"primary",onClick:j,rightIcon:t.jsx(pe,{}),isDisabled:y,children:x("Next")})]})]})}function Ee(e){const{countryEntry:n,cityEntry:s,paletteList:i,dataSource:r,refLink:c,justification:h,onPrev:m}=e,{t:y}=w(),f=he(),C=j("primary.500","primary.300"),b=k.useRef(null),v=[`**Data source:** ${r?f(ee[r]):"(REPLACE ME)"}`,`**Reference link:** ${c||"(REPLACE ME)"}`,`**Justification:** ${h||"(REPLACE ME)"}`,ne,te("country",n),te("city",s),te("lines",i)].join("\n\n"),S=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+s?.name?.en,body:v}),L=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+s?.name?.en});return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:y("If the button below doesn't work for you, please follow the instructions below:")}),t.jsxs(x,{children:[t.jsxs(d,{children:[y("Open")," ",t.jsxs(g,{color:C,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+L.toString(),isExternal:!0,children:["Issue: New Palettes Request ",t.jsx(p,{as:me})]})]}),t.jsxs(d,{children:[y("Paste following text to the issue body")," ",t.jsx(a,{size:"xs",leftIcon:t.jsx(ye,{}),onClick:async()=>{b?.current&&(b.current.select(),await navigator.clipboard.writeText(v))},children:y("Copy")}),t.jsx(se,{ref:b,isReadOnly:!0,defaultValue:v,onClick:({target:e})=>e.select()})]})]})]}),t.jsxs(u,{children:[t.jsx(a,{variant:"ghost",onClick:m,mr:"auto",leftIcon:t.jsx(ge,{}),children:y("Previous")}),t.jsx(a,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+S.toString(),"_blank"),children:y("1-click open issue")})]})]})}function Oe(e){const{isOpen:n,onClose:s}=e,{t:i}=w(),[r,a]=k.useState([]),[o,l]=k.useState([]),[c,d]=k.useState({}),[u,h]=k.useState(""),[j,x]=k.useState(""),[g,p]=k.useState(""),[v,S]=k.useState(!1),[E,O]=k.useState(!1),{countryList:R}=L((e=>e.app)),P=L((e=>e.ticket)),I=ie.getCountryEntry(P),N=ie.getCityEntry(P),z=ie.getPalettes(P);k.useEffect((()=>{n?(a(ie.getCountryErrors(P)),l(ie.getCityErrors(P,R)),d(ie.getLineErrors(P,R))):(S(!1),h(""),x(""),p(""),O(!1))}),[n]);const D=r.length>0||o.length>0||Object.values(c).flat().length>0,U=D&&!v,A=!U&&!E;return t.jsxs(m,{blockScrollOnMount:!1,isOpen:n,onClose:s,scrollBehavior:"inside",children:[t.jsx(y,{}),t.jsxs(f,{children:[t.jsx(C,{children:i("Submit palettes")}),t.jsx(b,{onClick:()=>{U||A||re.storage.remove(ae),s()}}),U&&t.jsx(ke,{countryErrors:r,cityErrors:o,lineErrors:c,onIgnore:()=>S(!0),onClose:s}),A&&t.jsx(Le,{dataSource:u,onDataSourceChange:h,refLink:j,onRefLinkChange:x,justification:g,onJustificationChange:p,onPrev:D?()=>S(!1):void 0,onNext:()=>O(!0)}),!U&&!A&&t.jsx(Ee,{countryEntry:I,cityEntry:N,paletteList:z,dataSource:u,refLink:j,justification:g,onPrev:()=>O(!1)})]})]})}function Re(e){const{isOpen:n,onClose:s,incomingState:i}=e,{t:r}=w(),l=S();return t.jsxs(m,{isOpen:n,onClose:s,children:[t.jsx(y,{}),t.jsxs(f,{children:[t.jsx(C,{children:r("Unsaved draft")}),t.jsx(b,{}),t.jsx(o,{children:r("Do you want to continue with your last unsaved ticket?")}),t.jsx(u,{children:t.jsxs(h,{children:[t.jsx(a,{onClick:()=>{re.storage.remove(ae),s()},children:r("Discard")}),t.jsx(a,{colorScheme:"primary",onClick:()=>{i&&l(oe(i)),s()},children:r("Continue")})]})})]})]})}}}}));
