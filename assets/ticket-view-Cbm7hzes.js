import{j as e,o as pe,F as Z,G as y,N as D,p as B,n as T,q as je,g as A,e as N,h as ne,T as F,r as fe,s as be,f,t as C,v as oe,b as Ce,d as re,w as G,L as ve,D as ye}from"./mantine-BanmS24x.js";import{l as v,r as m}from"./react-BFtFWddK.js";import{L as X,d as ie,e as le,f as J,u as k,g as Q,h as U,i as Se,j as we,k as ke,l as Ee,m as Le,n as Re,o as Te,p as Me,q as Ne,t as Pe,v as Oe,w as ze,x as Ie,y as Ae,M as $,z as _e,A as De,a as Be,B as ce,C as Fe,D as Je,F as Ge,G as Ve,H as Ke,I as Ye,J as $e,K as qe,N as He,O as We,P as q,Q as ue,S as de,T as Ze,U as Xe,V as H,W as Qe,X as z,Y as Ue,r as I,Z as V,_ as he,$ as et,b as tt,c as st,a0 as nt,E as at}from"./index-Wltgqzmt.js";import{u as P}from"./use-translated-name-B3bXP-Zb.js";import{P as ot,a as rt}from"./pantone-input-BLLvP6ta.js";import{c as W}from"./palette-card.module-C5ejK6cJ.js";const it=n=>{var s;const{onUpdate:a,onLangSwitch:i,onRemove:l}=n,x=(s=n.entries)!=null?s:[],{t:h}=v(),d=P(),o=Object.entries(X).map(([u,t])=>({value:u,label:d(t),disabled:x.some(r=>r[0]===u)})),c=()=>{const u=Object.keys(X).filter(t=>!x.find(r=>r[0]===t))[0];a(u,"")};return e.jsx(pe,{legend:h("Multi-languages"),children:x.map(([u,t],r,p)=>e.jsxs(Z,{pt:4,align:"center","data-testid":"entry-card-stack-"+u,children:[e.jsxs(y,{gap:"xs",flex:1,grow:!0,children:[e.jsx(D,{size:"xs","aria-label":h("Language"),value:u,onChange:({currentTarget:{value:j}})=>i(u,j),data:o}),e.jsx(B,{size:"xs","aria-label":h("Name"),placeholder:h("Enter name"),value:t,onChange:({currentTarget:{value:j}})=>a(u,j)})]}),e.jsxs(Z,{ml:8,wrap:"nowrap",children:[r===p.length-1?e.jsx(T,{size:"sm",variant:"filled","aria-label":h("Add a name in another language"),title:h("Add a name in another language"),onClick:c,children:e.jsx(ie,{})}):e.jsx(je,{w:22}),p.length>1&&e.jsx(T,{size:"sm",variant:"outline","aria-label":h("Remove this name"),title:h("Remove this name"),onClick:()=>l(u),ml:4,children:e.jsx(le,{})})]})]},r))})};function ee(n){return e.jsx(it,{...n})}function lt(){const{t:n,i18n:a}=v(),i=P(),l=J(),{countryList:x}=k(t=>t.app),{country:h,newCountry:d,countryName:o,newCountryLang:c}=k(t=>t.ticket),s=[{value:"",label:n("Please select..."),disabled:!0},...x.filter(t=>t.id!=="UN").map(t=>({value:t.id,label:i(t.name)})).toSorted((t,r)=>t.label.localeCompare(r.label,a.languages[0])),{value:"new",label:n("Add a country/region...")}],u=Object.entries(X).map(([t,r])=>({value:t,label:i(r)}));return e.jsxs(Q,{children:[e.jsx(U,{children:e.jsx(A,{order:2,size:"h4",children:n("Country/Region")})}),e.jsxs(N,{py:4,gap:"xs",children:[e.jsxs(y,{align:"flex-start",grow:!0,children:[e.jsx(D,{label:n("Country/Region"),value:h,onChange:({currentTarget:{value:t}})=>l(Se(t)),data:s}),h==="new"&&e.jsx(B,{label:n("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:d,onChange:({currentTarget:{value:t}})=>l(we(t)),error:d&&!d.match(/^[A-Z]{2}$|^GB[A-Z]{3}$/)?n("Country code should be in the format of ISO 3166-1 alpha-2"):void 0}),h==="new"&&e.jsx(D,{label:n("Official language"),value:c,onChange:({currentTarget:{value:t}})=>l(ke(t||void 0)),data:u})]}),h==="new"&&e.jsx(ee,{entries:o,onUpdate:(t,r)=>l(Re({lang:t,name:r})),onLangSwitch:(t,r)=>l(Le({prevLang:t,nextLang:r})),onRemove:t=>l(Ee(t))})]})]})}function ct(){const{t:n,i18n:a}=v(),i=J(),l=P(),{cityList:x}=k(t=>t.app),{country:h,city:d,newCity:o,cityName:c}=k(t=>t.ticket),s=[{value:"",label:n("Please select..."),disabled:!0},...x.filter(t=>t.country===h).map(t=>({value:t.id,label:l(t.name)})).toSorted((t,r)=>t.label.localeCompare(r.label,a.languages[0])),{value:"new",label:n("Add a city")+"..."}],u=async t=>{if(t==="new"){i(Oe("new"));return}const r=await ze(t,x);i(r?Ie(r):Ae())};return e.jsxs(Q,{children:[e.jsx(U,{children:e.jsx(A,{order:2,size:"h4",children:n("City")})}),e.jsxs(N,{py:4,gap:"xs",children:[e.jsxs(y,{align:"flex-start",grow:!0,children:[e.jsx(D,{label:n("City"),value:d,onChange:({currentTarget:{value:t}})=>u(t),data:s}),d==="new"&&e.jsx(B,{label:n("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:o,onChange:({currentTarget:{value:t}})=>i(Te(t)),error:o&&o.match(/[^a-z]/)?"City code should contain lower case letters only":void 0})]}),d==="new"&&e.jsx(ee,{entries:c,onUpdate:(t,r)=>i(Pe({lang:t,name:r})),onLangSwitch:(t,r)=>i(Ne({prevLang:t,nextLang:r})),onRemove:t=>i(Me(t))})]})]})}function ut({lineDetail:n,onUpdate:a,onMoveUp:i,onMoveDown:l,onCopy:x,onRemove:h,onNameUpdate:d,onNameRemove:o,onLangSwitch:c}){var _,w;const{t:s}=v(),u=P(),{pantoneReady:t}=k(g=>g.app),[r,p]=m.useState(!!n.pantone),[j,E]=m.useState(!1),S=m.useRef(null),L=()=>{j?E(!1):(E(!0),setTimeout(()=>{var g;(g=S.current)==null||g.scrollIntoView({behavior:"smooth"})},0))},O=[{label:s("Black"),value:$.black},{label:s("White"),value:$.white}],b=n.fg===$.black?"black":"white";return e.jsxs(ne,{ref:S,className:W.editable,p:"sm",withBorder:!0,children:[e.jsxs(ne.Section,{bg:n.colour,p:"sm",className:W["card-section"],children:[e.jsx(F,{span:!0,style:{color:b},children:u(Object.fromEntries(n.nameEntity))}),e.jsxs(y,{gap:"xs",ml:"auto",children:[e.jsx(T,{size:"xs",variant:"subtle",color:b,"aria-label":s("Move up"),title:s("Move up"),onClick:i,children:e.jsx(_e,{})}),e.jsx(T,{size:"xs",variant:"subtle",color:b,"aria-label":s("Move down"),title:s("Move down"),onClick:l,children:e.jsx(De,{})}),e.jsx(T,{size:"xs",variant:"subtle",color:b,"aria-label":s("Edit"),title:s("Edit"),onClick:L,children:e.jsx(Be,{})}),e.jsx(T,{size:"xs",variant:"subtle",color:b,"aria-label":s("Duplicate"),title:s("Duplicate"),onClick:x,children:e.jsx(ce,{})}),e.jsx(T,{size:"xs",variant:"subtle",color:b,"aria-label":s("Remove"),title:s("Remove"),onClick:h,children:e.jsx(le,{})})]})]}),j&&e.jsxs(N,{gap:"xs",mt:"xs",children:[e.jsxs(y,{gap:"xs",className:W["editable-group"],children:[e.jsx(B,{label:s("Line code"),placeholder:"e.g. twl, gz1, sh1",value:n.id,onChange:({currentTarget:{value:g}})=>a==null?void 0:a({id:g}),error:(_=n.id)!=null&&_.match(/[^a-z0-9]/)?s("Line code should be alphanumeric"):void 0}),e.jsx(fe,{label:s("Background colour"),value:n.colour,onChange:g=>a==null?void 0:a({colour:g}),disabled:t&&r}),t&&e.jsx(be,{label:s("Use PantoneÂ®"),checked:r,onChange:({currentTarget:{checked:g}})=>p(g),mt:"xl"}),t&&r&&e.jsx(ot,{value:(w=n.pantone)!=null?w:"",onChange:(g,R)=>a==null?void 0:a({pantone:g,colour:R})}),e.jsx(Fe,{size:"sm",label:s("Foreground colour"),data:O,value:n.fg,onChange:g=>a==null?void 0:a({fg:g})})]}),e.jsx(ee,{entries:n.nameEntity,onUpdate:(g,R)=>d==null?void 0:d(g,R),onLangSwitch:(g,R)=>c==null?void 0:c(g,R),onRemove:g=>o==null?void 0:o(g)})]})]})}function dt(){const{t:n}=v(),a=J(),i=k(o=>o.ticket.lines),l=m.useRef(null),x=m.useCallback(()=>{setTimeout(()=>{var o,c;(c=(o=l.current)==null?void 0:o.lastElementChild)==null||c.scrollIntoView({behavior:"smooth"})},0)},[l.current]),h=o=>{a(He(o)),x()},d=()=>{a(We()),x()};return e.jsxs(Q,{children:[e.jsxs(U,{children:[e.jsx(A,{order:2,size:"h4",children:n("Lines")}),e.jsx(rt,{ml:"auto"})]}),e.jsxs(N,{ref:l,py:4,gap:"xs",children:[Object.entries(i).map(([o,c])=>e.jsx(ut,{lineDetail:c,onUpdate:s=>a(qe({entryId:o,updates:s})),onMoveUp:()=>a($e(o)),onMoveDown:()=>a(Ye(o)),onCopy:()=>h(o),onRemove:()=>a(Ke(o)),onNameUpdate:(s,u)=>a(Ve({entryId:o,lang:s,name:u})),onLangSwitch:(s,u)=>a(Ge({entryId:o,prevLang:s,nextLang:u})),onNameRemove:s=>a(Je({entryId:o,lang:s}))},o)),e.jsx(f,{size:"xs",variant:"outline",leftSection:e.jsx(ie,{}),ml:"auto",onClick:d,children:n("Add a line")})]})]})}const ht="_content_euz2o_1",xt="_body_euz2o_7",M={content:ht,body:xt,"stepper-root":"_stepper-root_euz2o_14","stepper-content":"_stepper-content_euz2o_21","step-body":"_step-body_euz2o_28"};function gt(n){const{countryErrors:a,cityErrors:i,lineErrors:l,onIgnore:x,onClose:h}=n,{t:d}=v(),o=P();return e.jsxs(e.Fragment,{children:[e.jsxs(N,{gap:"xs",className:M["step-body"],children:[e.jsx(F,{children:d("Your inputs contain the following errors. Please consider fixing it before submitting.")}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(A,{order:3,size:"h5",children:d("Country/Region")}),e.jsx(C,{size:"sm",withPadding:!0,"aria-label":"List of country errors",children:a.map((c,s)=>e.jsx(C.Item,{children:o(q[c])},s))})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(A,{order:3,size:"h5",children:d("City")}),e.jsx(C,{size:"sm",withPadding:!0,"aria-label":"List of city errors",children:i.map((c,s)=>e.jsx(C.Item,{children:o(q[c])},s))})]}),Object.values(l).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(A,{order:3,size:"h5",children:d("Lines")}),e.jsx(C,{size:"sm",withPadding:!0,"aria-label":"List of line errors",children:Object.entries(l).map(([c,s])=>e.jsxs(C.Item,{children:[c,e.jsx(C,{size:"sm",withPadding:!0,children:s.map((u,t)=>e.jsx(C.Item,{children:o(q[u])},t))})]},c))})]})]}),e.jsxs(y,{gap:"sm",pt:"xs",children:[e.jsx(f,{variant:"default",ml:"auto",onClick:h,children:d("Go back")}),e.jsx(f,{onClick:x,children:d("Submit anyway")})]})]})}const ae=n=>{var a;return!!((a=n.match(/^https?:\/\//))!=null&&a[0])};function mt(n){const{dataSource:a,onDataSourceChange:i,refLink:l,onRefLinkChange:x,justification:h,onJustificationChange:d,onPrev:o,onNext:c}=n,{t:s}=v(),u=P(),t=[{value:"",label:s("Please select..."),disabled:!0},...Object.entries(ue).map(([p,j])=>({value:p,label:u(j)}))],r=!a||!l||!h||!ae(l);return e.jsxs(e.Fragment,{children:[e.jsxs(N,{gap:"xs",className:M["step-body"],children:[e.jsx(F,{children:s("Please provide suitable source and justification.")}),e.jsx(D,{label:s("Data source"),value:a,onChange:({currentTarget:{value:p}})=>i(p),data:t}),e.jsx(B,{label:s("Reference link"),placeholder:s("Enter a valid URL, e.g.")+" https://en.wikipedia.org",value:l,onChange:({currentTarget:{value:p}})=>x(p),error:l&&!ae(l)?s("URL is invalid"):void 0}),e.jsx(oe,{label:s("Justification"),placeholder:s("Briefly describe your changes and provide justification"),value:h,onChange:({currentTarget:{value:p}})=>d(p),autosize:!0,minRows:3})]}),e.jsxs(y,{gap:"sm",pt:"xs",children:[o&&e.jsx(f,{variant:"default",onClick:o,leftSection:e.jsx(de,{}),children:s("Previous")}),e.jsx(f,{ml:"auto",onClick:c,rightSection:e.jsx(Ze,{}),disabled:r,children:s("Next")})]})]})}function pt(n){var E,S,L,O;const{countryEntry:a,cityEntry:i,paletteList:l,dataSource:x,refLink:h,justification:d,onPrev:o}=n,{t:c}=v(),s=P(),u=m.useRef(null),t=["**Data source:** ".concat(x?s(ue[x]):"(REPLACE ME)"),"**Reference link:** ".concat(h||"(REPLACE ME)"),"**Justification:** ".concat(d||"(REPLACE ME)"),Xe,H("country",a),H("city",i),H("lines",l)].join("\n\n"),r=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:(S=(E=i==null?void 0:i.name)==null?void 0:E.en)!=null?S:"[CITY]",body:t}),p=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:(O=(L=i==null?void 0:i.name)==null?void 0:L.en)!=null?O:"[CITY]"}),j=async()=>{u!=null&&u.current&&(u.current.select(),await navigator.clipboard.writeText(t))};return e.jsxs(e.Fragment,{children:[e.jsxs(N,{gap:"xs",className:M["step-body"],children:[e.jsx(F,{children:c("If the button below doesn't work for you, please follow the instructions below:")}),e.jsxs(C,{type:"ordered",withPadding:!0,children:[e.jsxs(C.Item,{children:[c("Open")," ",e.jsxs(Ce,{href:"https://github.com/railmapgen/rmg-palette/issues/new?"+p.toString(),target:"_blank",children:["Issue: New Palettes Request ",e.jsx(Qe,{})]})]}),e.jsxs(C.Item,{children:[c("Paste following text to the issue body")," ",e.jsx(f,{size:"xs",variant:"light",leftSection:e.jsx(ce,{}),onClick:j,children:c("Copy")}),e.jsx(oe,{ref:u,readOnly:!0,defaultValue:t,onClick:({target:b})=>b.select(),mt:"xs",autosize:!0,maxRows:3})]})]})]}),e.jsxs(y,{gap:"sm",pt:"xs",children:[e.jsx(f,{variant:"default",onClick:o,leftSection:e.jsx(de,{}),children:c("Previous")}),e.jsx(f,{ml:"auto",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+r.toString(),"_blank"),children:c("1-click open issue")})]})]})}function jt(n){const{isOpen:a,onClose:i}=n,{t:l}=v(),[x,h]=m.useState([]),[d,o]=m.useState([]),[c,s]=m.useState({}),[u,t]=m.useState(""),[r,p]=m.useState(""),[j,E]=m.useState(""),[S,L]=m.useState(!1),[O,b]=m.useState(!1),{countryList:_}=k(Y=>Y.app),w=k(Y=>Y.ticket),g=z.getCountryEntry(w),R=z.getCityEntry(w),xe=z.getPalettes(w);m.useEffect(()=>{a?(h(z.getCountryErrors(w)),o(z.getCityErrors(w,_)),s(z.getLineErrors(w,_))):(L(!1),t(""),p(""),E(""),b(!1))},[a]);const te=x.length>0||d.length>0||Object.values(c).flat().length>0,K=te&&!S,se=!K&&!O,ge=()=>K?0:se?1:2,me=()=>{!K&&!se&&I.storage.remove(V),i()};return e.jsx(re,{classNames:{content:M.content,body:M.body},opened:a,onClose:me,title:l("Submit palettes"),children:e.jsxs(G,{active:ge(),classNames:{root:M["stepper-root"],content:M["stepper-content"]},children:[e.jsx(G.Step,{label:l("Validate"),color:S?"orange":void 0,completedIcon:S?e.jsx(Ue,{size:24}):void 0,children:e.jsx(gt,{countryErrors:x,cityErrors:d,lineErrors:c,onIgnore:()=>L(!0),onClose:i})}),e.jsx(G.Step,{label:l("Justify"),children:e.jsx(mt,{dataSource:u,onDataSourceChange:t,refLink:r,onRefLinkChange:p,justification:j,onJustificationChange:E,onPrev:te?()=>L(!1):void 0,onNext:()=>b(!0)})}),e.jsx(G.Step,{label:l("Submit"),children:e.jsx(pt,{countryEntry:g,cityEntry:R,paletteList:xe,dataSource:u,refLink:r,justification:j,onPrev:()=>b(!1)})})]})})}function ft(n){const{isOpen:a,onClose:i,incomingState:l}=n,{t:x}=v(),h=J(),d=()=>{I.storage.remove(V),i()},o=()=>{l&&h(he(l)),i()};return e.jsx(re,{opened:a,onClose:i,title:x("Unsaved draft"),children:e.jsxs(Z,{direction:"column",children:[e.jsx(F,{children:x("Do you want to continue with your last unsaved ticket?")}),e.jsxs(y,{gap:"xs",mt:"xs",children:[e.jsx(f,{variant:"default",ml:"auto",onClick:d,children:x("Discard")}),e.jsx(f,{onClick:o,children:x("Continue")})]})]})})}function kt(){const{t:n}=v(),a=J(),{isDataLoading:i}=k(t=>t.app),[l,x]=m.useState(),[h,d]=m.useState(!1),[o,c]=m.useState(!1);m.useEffect(()=>{const t=I.storage.get(V);if(t)try{const r=JSON.parse(t);Object.keys(r.lines).length>0&&Object.values(r.lines)[0].id&&(x(r),d(!0))}catch(r){et.error("<TicketView/>, unable to restore draft ticket",t)}},[]);const s=()=>{I.openApp({appId:"rmg-palette"})},u=()=>{a(he()),I.storage.remove(V),I.event(at.RESET_TICKET,{})};return e.jsxs(tt,{w:{base:"100%",sm:600},style:{alignSelf:"center"},children:[e.jsx(ve,{visible:i}),e.jsxs(st,{direction:"column",px:"xs",style:{overflowY:"auto"},children:[e.jsx(lt,{}),e.jsx(ct,{}),e.jsx(dt,{})]}),e.jsx(ye,{}),e.jsx(nt,{children:e.jsxs(y,{flex:1,gap:"sm",children:[e.jsx(f,{variant:"default",onClick:s,children:n("Go back")}),e.jsx(f,{variant:"default",ml:"auto",onClick:u,children:n("Reset")}),e.jsx(f,{onClick:()=>c(!0),children:n("Submit")})]})}),e.jsx(ft,{isOpen:h,onClose:()=>d(!1),incomingState:l}),e.jsx(jt,{isOpen:o,onClose:()=>c(!1)})]})}export{kt as default};
